import webauthn_signature from "../src/_utils/webauthn_signature.js";
import webauthn_signature_build from "../_utils/webauthn_signature.js";

import { webcrypto } from "crypto";
import { deepStrictEqual } from "assert";

const public_key =
  "PUB_WA_6eRs44BYTJKPrGTCqR5TuMSQbCrZsNdNSXTHNuNitSdTfVQe8JSf89qy7JwxEnFW7";

it("WA signature with v=1", async () => {
  global.window = { crypto: { subtle: webcrypto.subtle } };

  const expected_sig =
    "SIG_WA_B4NU8hS8fh4roem1gZiiGTVkQmoehBxRhy6DRksd9N9sgRnbDBBovfSMYiacxNLE7KsFyk99nC6ygspKgkXrbtrqBdN1acxE1Y7co8s8jtsuN9rhqW2PXaqakKN3pszvi6ZAV6TDpfmzPTi6HPRtE8WF9TcGaRYFxGWBSdMoAsPz5cdUhE9zWWh5UsyuoZTuhyo62ac2TUGwgtiuXs4LvuqqdCUai8JpWkrwnK7pdTZY71iDUSyEM15RczoqKbBbTUSpFpi4QArS9Fheg75jMez3RXRE62XsiWT1Vc9WyD4GwCr8dyoFUDAWj8TmxcvxXYKoeTHQroCJAoQRXqZUddWvM9LjZR8ULsjhELosU7uAJ2ACMJAet82idQ7LrT4jFKC9XHUfqw2gzZVaZXRJ2dZCTpVdEqbhgFsrB9nXat5Yu2RCmf3aSw9nwTRZPtuksJCj4jyz8TueYFtPPzCCmfHXCUSSMrKXfm";

  const authenticatorData = Object.values({
    "0": 73,
    "1": 150,
    "2": 13,
    "3": 229,
    "4": 136,
    "5": 14,
    "6": 140,
    "7": 104,
    "8": 116,
    "9": 52,
    "10": 23,
    "11": 15,
    "12": 100,
    "13": 118,
    "14": 96,
    "15": 91,
    "16": 143,
    "17": 228,
    "18": 174,
    "19": 185,
    "20": 162,
    "21": 134,
    "22": 50,
    "23": 199,
    "24": 153,
    "25": 92,
    "26": 243,
    "27": 186,
    "28": 131,
    "29": 29,
    "30": 151,
    "31": 99,
    "32": 29,
    "33": 0,
    "34": 0,
    "35": 0,
    "36": 0,
  });

  const signature = Object.values({
    "0": 48,
    "1": 69,
    "2": 2,
    "3": 32,
    "4": 109,
    "5": 111,
    "6": 224,
    "7": 183,
    "8": 66,
    "9": 226,
    "10": 52,
    "11": 67,
    "12": 134,
    "13": 186,
    "14": 107,
    "15": 240,
    "16": 204,
    "17": 78,
    "18": 230,
    "19": 69,
    "20": 212,
    "21": 247,
    "22": 131,
    "23": 168,
    "24": 232,
    "25": 83,
    "26": 105,
    "27": 101,
    "28": 245,
    "29": 67,
    "30": 178,
    "31": 13,
    "32": 237,
    "33": 193,
    "34": 251,
    "35": 184,
    "36": 2,
    "37": 33,
    "38": 0,
    "39": 166,
    "40": 40,
    "41": 102,
    "42": 67,
    "43": 137,
    "44": 114,
    "45": 106,
    "46": 39,
    "47": 169,
    "48": 232,
    "49": 209,
    "50": 232,
    "51": 171,
    "52": 135,
    "53": 91,
    "54": 125,
    "55": 245,
    "56": 109,
    "57": 117,
    "58": 126,
    "59": 99,
    "60": 159,
    "61": 177,
    "62": 232,
    "63": 27,
    "64": 215,
    "65": 226,
    "66": 216,
    "67": 192,
    "68": 127,
    "69": 114,
    "70": 120,
  });

  const clientDataJSON = Object.values({
    "0": 123,
    "1": 34,
    "2": 116,
    "3": 121,
    "4": 112,
    "5": 101,
    "6": 34,
    "7": 58,
    "8": 34,
    "9": 119,
    "10": 101,
    "11": 98,
    "12": 97,
    "13": 117,
    "14": 116,
    "15": 104,
    "16": 110,
    "17": 46,
    "18": 103,
    "19": 101,
    "20": 116,
    "21": 34,
    "22": 44,
    "23": 34,
    "24": 99,
    "25": 104,
    "26": 97,
    "27": 108,
    "28": 108,
    "29": 101,
    "30": 110,
    "31": 103,
    "32": 101,
    "33": 34,
    "34": 58,
    "35": 34,
    "36": 122,
    "37": 81,
    "38": 110,
    "39": 103,
    "40": 52,
    "41": 68,
    "42": 116,
    "43": 77,
    "44": 83,
    "45": 113,
    "46": 85,
    "47": 48,
    "48": 81,
    "49": 88,
    "50": 107,
    "51": 108,
    "52": 55,
    "53": 75,
    "54": 57,
    "55": 110,
    "56": 121,
    "57": 102,
    "58": 105,
    "59": 67,
    "60": 90,
    "61": 69,
    "62": 102,
    "63": 102,
    "64": 50,
    "65": 97,
    "66": 107,
    "67": 100,
    "68": 68,
    "69": 45,
    "70": 67,
    "71": 85,
    "72": 54,
    "73": 112,
    "74": 77,
    "75": 73,
    "76": 51,
    "77": 67,
    "78": 56,
    "79": 34,
    "80": 44,
    "81": 34,
    "82": 111,
    "83": 114,
    "84": 105,
    "85": 103,
    "86": 105,
    "87": 110,
    "88": 34,
    "89": 58,
    "90": 34,
    "91": 104,
    "92": 116,
    "93": 116,
    "94": 112,
    "95": 115,
    "96": 58,
    "97": 47,
    "98": 47,
    "99": 108,
    "100": 111,
    "101": 99,
    "102": 97,
    "103": 108,
    "104": 104,
    "105": 111,
    "106": 115,
    "107": 116,
    "108": 58,
    "109": 51,
    "110": 48,
    "111": 48,
    "112": 48,
    "113": 34,
    "114": 44,
    "115": 34,
    "116": 99,
    "117": 114,
    "118": 111,
    "119": 115,
    "120": 115,
    "121": 79,
    "122": 114,
    "123": 105,
    "124": 103,
    "125": 105,
    "126": 110,
    "127": 34,
    "128": 58,
    "129": 102,
    "130": 97,
    "131": 108,
    "132": 115,
    "133": 101,
    "134": 44,
    "135": 34,
    "136": 111,
    "137": 116,
    "138": 104,
    "139": 101,
    "140": 114,
    "141": 95,
    "142": 107,
    "143": 101,
    "144": 121,
    "145": 115,
    "146": 95,
    "147": 99,
    "148": 97,
    "149": 110,
    "150": 95,
    "151": 98,
    "152": 101,
    "153": 95,
    "154": 97,
    "155": 100,
    "156": 100,
    "157": 101,
    "158": 100,
    "159": 95,
    "160": 104,
    "161": 101,
    "162": 114,
    "163": 101,
    "164": 34,
    "165": 58,
    "166": 34,
    "167": 100,
    "168": 111,
    "169": 32,
    "170": 110,
    "171": 111,
    "172": 116,
    "173": 32,
    "174": 99,
    "175": 111,
    "176": 109,
    "177": 112,
    "178": 97,
    "179": 114,
    "180": 101,
    "181": 32,
    "182": 99,
    "183": 108,
    "184": 105,
    "185": 101,
    "186": 110,
    "187": 116,
    "188": 68,
    "189": 97,
    "190": 116,
    "191": 97,
    "192": 74,
    "193": 83,
    "194": 79,
    "195": 78,
    "196": 32,
    "197": 97,
    "198": 103,
    "199": 97,
    "200": 105,
    "201": 110,
    "202": 115,
    "203": 116,
    "204": 32,
    "205": 97,
    "206": 32,
    "207": 116,
    "208": 101,
    "209": 109,
    "210": 112,
    "211": 108,
    "212": 97,
    "213": 116,
    "214": 101,
    "215": 46,
    "216": 32,
    "217": 83,
    "218": 101,
    "219": 101,
    "220": 32,
    "221": 104,
    "222": 116,
    "223": 116,
    "224": 112,
    "225": 115,
    "226": 58,
    "227": 47,
    "228": 47,
    "229": 103,
    "230": 111,
    "231": 111,
    "232": 46,
    "233": 103,
    "234": 108,
    "235": 47,
    "236": 121,
    "237": 97,
    "238": 98,
    "239": 80,
    "240": 101,
    "241": 120,
    "242": 34,
    "243": 125,
  });

  const wa_sig = await webauthn_signature(
    {
      authenticatorData,
      clientDataJSON,
      signature,
    },
    public_key
  );
  const wa_sig2 = await webauthn_signature_build(
    {
      authenticatorData,
      clientDataJSON,
      signature,
    },
    public_key
  );

  deepStrictEqual(wa_sig, expected_sig);
  deepStrictEqual(wa_sig2, expected_sig);
  delete global.window;
});

it("WA signature with v=0", async () => {
  global.window = { crypto: { subtle: webcrypto.subtle } };

  const expected_sig =
    "SIG_WA_AvdP22KvEX2UQhbUq7svhiqUnHxgVTb7sVnpuoQqm5vkNtgwpAxwPHW2oPPxW82qfuPvtx69eZyiY43Q62FRWruZhq5hS7JdVVSMNRv7Lb54igHMjusGF28BpXDLW1eij9c9AoraZ2QNcPHkygY9tahkypTYcLtHoM21Mo4bCzmjh4LZyK1w8Eo72saCECrcpoPNVau8jdM1whjrQ2wtMAqzQXhxGudGkrKrRWNA6rgpuUcKTUYQ5n4jm3AC3QbuGk98YCptD79h7mdo2zsDFCs5iPoKKVvrWBfGvQBW1jkBtuj7tVs4JTEyyjv7toBEE6H32SoB5DvJPanCM5BwKbaEGcAyJRTv7kwg7Z9pLf48yEvZJ693LxhPp9ucJH3VD7Lyk4yn2c7fhWToJNMTVVih1EuRyKtECv7eMbcLXeFQRMMjrXZC9jmee1pD6hYnquBaKjV9ewbi2n5sJwWvwiskULt9wZtPGQ";

  const authenticatorData = Object.values({
    "0": 73,
    "1": 150,
    "2": 13,
    "3": 229,
    "4": 136,
    "5": 14,
    "6": 140,
    "7": 104,
    "8": 116,
    "9": 52,
    "10": 23,
    "11": 15,
    "12": 100,
    "13": 118,
    "14": 96,
    "15": 91,
    "16": 143,
    "17": 228,
    "18": 174,
    "19": 185,
    "20": 162,
    "21": 134,
    "22": 50,
    "23": 199,
    "24": 153,
    "25": 92,
    "26": 243,
    "27": 186,
    "28": 131,
    "29": 29,
    "30": 151,
    "31": 99,
    "32": 29,
    "33": 0,
    "34": 0,
    "35": 0,
    "36": 0,
  });

  const signature = Object.values({
    "0": 48,
    "1": 70,
    "2": 2,
    "3": 33,
    "4": 0,
    "5": 255,
    "6": 65,
    "7": 38,
    "8": 165,
    "9": 140,
    "10": 15,
    "11": 53,
    "12": 92,
    "13": 189,
    "14": 86,
    "15": 11,
    "16": 129,
    "17": 66,
    "18": 184,
    "19": 75,
    "20": 70,
    "21": 129,
    "22": 205,
    "23": 221,
    "24": 250,
    "25": 32,
    "26": 210,
    "27": 182,
    "28": 231,
    "29": 212,
    "30": 244,
    "31": 45,
    "32": 161,
    "33": 109,
    "34": 111,
    "35": 243,
    "36": 169,
    "37": 2,
    "38": 33,
    "39": 0,
    "40": 157,
    "41": 214,
    "42": 244,
    "43": 203,
    "44": 53,
    "45": 117,
    "46": 207,
    "47": 225,
    "48": 150,
    "49": 189,
    "50": 129,
    "51": 138,
    "52": 32,
    "53": 142,
    "54": 48,
    "55": 176,
    "56": 118,
    "57": 3,
    "58": 221,
    "59": 6,
    "60": 249,
    "61": 105,
    "62": 157,
    "63": 224,
    "64": 121,
    "65": 145,
    "66": 94,
    "67": 132,
    "68": 26,
    "69": 182,
    "70": 161,
    "71": 1,
  });

  const clientDataJSON = Object.values({
    "0": 123,
    "1": 34,
    "2": 116,
    "3": 121,
    "4": 112,
    "5": 101,
    "6": 34,
    "7": 58,
    "8": 34,
    "9": 119,
    "10": 101,
    "11": 98,
    "12": 97,
    "13": 117,
    "14": 116,
    "15": 104,
    "16": 110,
    "17": 46,
    "18": 103,
    "19": 101,
    "20": 116,
    "21": 34,
    "22": 44,
    "23": 34,
    "24": 99,
    "25": 104,
    "26": 97,
    "27": 108,
    "28": 108,
    "29": 101,
    "30": 110,
    "31": 103,
    "32": 101,
    "33": 34,
    "34": 58,
    "35": 34,
    "36": 66,
    "37": 97,
    "38": 105,
    "39": 99,
    "40": 74,
    "41": 119,
    "42": 49,
    "43": 95,
    "44": 110,
    "45": 50,
    "46": 119,
    "47": 79,
    "48": 52,
    "49": 53,
    "50": 48,
    "51": 90,
    "52": 121,
    "53": 73,
    "54": 54,
    "55": 106,
    "56": 117,
    "57": 85,
    "58": 121,
    "59": 101,
    "60": 111,
    "61": 98,
    "62": 81,
    "63": 88,
    "64": 121,
    "65": 49,
    "66": 48,
    "67": 74,
    "68": 87,
    "69": 69,
    "70": 89,
    "71": 117,
    "72": 56,
    "73": 95,
    "74": 122,
    "75": 76,
    "76": 77,
    "77": 69,
    "78": 107,
    "79": 34,
    "80": 44,
    "81": 34,
    "82": 111,
    "83": 114,
    "84": 105,
    "85": 103,
    "86": 105,
    "87": 110,
    "88": 34,
    "89": 58,
    "90": 34,
    "91": 104,
    "92": 116,
    "93": 116,
    "94": 112,
    "95": 115,
    "96": 58,
    "97": 47,
    "98": 47,
    "99": 108,
    "100": 111,
    "101": 99,
    "102": 97,
    "103": 108,
    "104": 104,
    "105": 111,
    "106": 115,
    "107": 116,
    "108": 58,
    "109": 51,
    "110": 48,
    "111": 48,
    "112": 48,
    "113": 34,
    "114": 44,
    "115": 34,
    "116": 99,
    "117": 114,
    "118": 111,
    "119": 115,
    "120": 115,
    "121": 79,
    "122": 114,
    "123": 105,
    "124": 103,
    "125": 105,
    "126": 110,
    "127": 34,
    "128": 58,
    "129": 102,
    "130": 97,
    "131": 108,
    "132": 115,
    "133": 101,
    "134": 44,
    "135": 34,
    "136": 111,
    "137": 116,
    "138": 104,
    "139": 101,
    "140": 114,
    "141": 95,
    "142": 107,
    "143": 101,
    "144": 121,
    "145": 115,
    "146": 95,
    "147": 99,
    "148": 97,
    "149": 110,
    "150": 95,
    "151": 98,
    "152": 101,
    "153": 95,
    "154": 97,
    "155": 100,
    "156": 100,
    "157": 101,
    "158": 100,
    "159": 95,
    "160": 104,
    "161": 101,
    "162": 114,
    "163": 101,
    "164": 34,
    "165": 58,
    "166": 34,
    "167": 100,
    "168": 111,
    "169": 32,
    "170": 110,
    "171": 111,
    "172": 116,
    "173": 32,
    "174": 99,
    "175": 111,
    "176": 109,
    "177": 112,
    "178": 97,
    "179": 114,
    "180": 101,
    "181": 32,
    "182": 99,
    "183": 108,
    "184": 105,
    "185": 101,
    "186": 110,
    "187": 116,
    "188": 68,
    "189": 97,
    "190": 116,
    "191": 97,
    "192": 74,
    "193": 83,
    "194": 79,
    "195": 78,
    "196": 32,
    "197": 97,
    "198": 103,
    "199": 97,
    "200": 105,
    "201": 110,
    "202": 115,
    "203": 116,
    "204": 32,
    "205": 97,
    "206": 32,
    "207": 116,
    "208": 101,
    "209": 109,
    "210": 112,
    "211": 108,
    "212": 97,
    "213": 116,
    "214": 101,
    "215": 46,
    "216": 32,
    "217": 83,
    "218": 101,
    "219": 101,
    "220": 32,
    "221": 104,
    "222": 116,
    "223": 116,
    "224": 112,
    "225": 115,
    "226": 58,
    "227": 47,
    "228": 47,
    "229": 103,
    "230": 111,
    "231": 111,
    "232": 46,
    "233": 103,
    "234": 108,
    "235": 47,
    "236": 121,
    "237": 97,
    "238": 98,
    "239": 80,
    "240": 101,
    "241": 120,
    "242": 34,
    "243": 125,
  });

  const wa_sig = await webauthn_signature(
    {
      authenticatorData,
      clientDataJSON,
      signature,
    },
    public_key
  );

  deepStrictEqual(wa_sig, expected_sig);
  delete global.window;
});

it("WA signature 3", async () => {
  global.window = { crypto: { subtle: webcrypto.subtle } };

  const authenticatorData = Object.values({
    "0": 73,
    "1": 150,
    "2": 13,
    "3": 229,
    "4": 136,
    "5": 14,
    "6": 140,
    "7": 104,
    "8": 116,
    "9": 52,
    "10": 23,
    "11": 15,
    "12": 100,
    "13": 118,
    "14": 96,
    "15": 91,
    "16": 143,
    "17": 228,
    "18": 174,
    "19": 185,
    "20": 162,
    "21": 134,
    "22": 50,
    "23": 199,
    "24": 153,
    "25": 92,
    "26": 243,
    "27": 186,
    "28": 131,
    "29": 29,
    "30": 151,
    "31": 99,
    "32": 29,
    "33": 0,
    "34": 0,
    "35": 0,
    "36": 0,
  });

  const clientDataJSON = Object.values({
    "0": 123,
    "1": 34,
    "2": 116,
    "3": 121,
    "4": 112,
    "5": 101,
    "6": 34,
    "7": 58,
    "8": 34,
    "9": 119,
    "10": 101,
    "11": 98,
    "12": 97,
    "13": 117,
    "14": 116,
    "15": 104,
    "16": 110,
    "17": 46,
    "18": 103,
    "19": 101,
    "20": 116,
    "21": 34,
    "22": 44,
    "23": 34,
    "24": 99,
    "25": 104,
    "26": 97,
    "27": 108,
    "28": 108,
    "29": 101,
    "30": 110,
    "31": 103,
    "32": 101,
    "33": 34,
    "34": 58,
    "35": 34,
    "36": 51,
    "37": 118,
    "38": 45,
    "39": 78,
    "40": 89,
    "41": 120,
    "42": 103,
    "43": 67,
    "44": 104,
    "45": 87,
    "46": 84,
    "47": 87,
    "48": 90,
    "49": 75,
    "50": 120,
    "51": 115,
    "52": 68,
    "53": 106,
    "54": 121,
    "55": 86,
    "56": 102,
    "57": 89,
    "58": 99,
    "59": 78,
    "60": 100,
    "61": 87,
    "62": 120,
    "63": 85,
    "64": 121,
    "65": 77,
    "66": 76,
    "67": 86,
    "68": 100,
    "69": 109,
    "70": 115,
    "71": 75,
    "72": 99,
    "73": 88,
    "74": 90,
    "75": 85,
    "76": 121,
    "77": 110,
    "78": 103,
    "79": 34,
    "80": 44,
    "81": 34,
    "82": 111,
    "83": 114,
    "84": 105,
    "85": 103,
    "86": 105,
    "87": 110,
    "88": 34,
    "89": 58,
    "90": 34,
    "91": 104,
    "92": 116,
    "93": 116,
    "94": 112,
    "95": 115,
    "96": 58,
    "97": 47,
    "98": 47,
    "99": 108,
    "100": 111,
    "101": 99,
    "102": 97,
    "103": 108,
    "104": 104,
    "105": 111,
    "106": 115,
    "107": 116,
    "108": 58,
    "109": 51,
    "110": 48,
    "111": 48,
    "112": 48,
    "113": 34,
    "114": 44,
    "115": 34,
    "116": 99,
    "117": 114,
    "118": 111,
    "119": 115,
    "120": 115,
    "121": 79,
    "122": 114,
    "123": 105,
    "124": 103,
    "125": 105,
    "126": 110,
    "127": 34,
    "128": 58,
    "129": 102,
    "130": 97,
    "131": 108,
    "132": 115,
    "133": 101,
    "134": 125,
  });

  const signature = Object.values({
    "0": 48,
    "1": 68,
    "2": 2,
    "3": 32,
    "4": 112,
    "5": 169,
    "6": 215,
    "7": 42,
    "8": 189,
    "9": 155,
    "10": 14,
    "11": 236,
    "12": 105,
    "13": 134,
    "14": 63,
    "15": 137,
    "16": 170,
    "17": 112,
    "18": 24,
    "19": 156,
    "20": 233,
    "21": 40,
    "22": 175,
    "23": 144,
    "24": 167,
    "25": 218,
    "26": 157,
    "27": 171,
    "28": 174,
    "29": 216,
    "30": 241,
    "31": 248,
    "32": 21,
    "33": 167,
    "34": 144,
    "35": 35,
    "36": 2,
    "37": 32,
    "38": 62,
    "39": 69,
    "40": 52,
    "41": 119,
    "42": 228,
    "43": 74,
    "44": 90,
    "45": 142,
    "46": 245,
    "47": 204,
    "48": 85,
    "49": 252,
    "50": 222,
    "51": 252,
    "52": 106,
    "53": 127,
    "54": 113,
    "55": 107,
    "56": 119,
    "57": 81,
    "58": 190,
    "59": 54,
    "60": 209,
    "61": 181,
    "62": 116,
    "63": 84,
    "64": 73,
    "65": 17,
    "66": 105,
    "67": 138,
    "68": 152,
    "69": 187,
  });

  const wa_sig = await webauthn_signature(
    {
      authenticatorData,
      clientDataJSON,
      signature,
    },
    public_key
  );

  deepStrictEqual(
    wa_sig,
    "SIG_WA_JSt7AzbeACpfpCWYD6B1iPH7G21yHMwFsJXg7PDfE8Lozz56vwgjCzwVF5gX7eicG1TQKYMiNW1Dioepz3GWPNwmJmQVinUeRMyLa3tZBKxVHTvRLVUbGpxq7WZe7fRfN258QE7xcAm1x1Bkim6KQenrqkZ2KkspqgEub6kgJbn8hUkppR7mFRjQJSp1kohEh9h3TX2czEqopBmacPjGbTKt6hL3XY5NyxwCCAa2rnLeqGcSBtrzeFiffAZsFyqgrK3KXQp5crrDQiFaESBq6C6qFetf1fFj5zoewpoH9AGxmorSmWggyjSpFrZchLk5fWbxuLZ33qTpm"
  );
  delete global.window;
});

it("WA signature 4", async () => {
  global.window = { crypto: { subtle: webcrypto.subtle } };

  const authenticatorData = Object.values({
    "0": 73,
    "1": 150,
    "2": 13,
    "3": 229,
    "4": 136,
    "5": 14,
    "6": 140,
    "7": 104,
    "8": 116,
    "9": 52,
    "10": 23,
    "11": 15,
    "12": 100,
    "13": 118,
    "14": 96,
    "15": 91,
    "16": 143,
    "17": 228,
    "18": 174,
    "19": 185,
    "20": 162,
    "21": 134,
    "22": 50,
    "23": 199,
    "24": 153,
    "25": 92,
    "26": 243,
    "27": 186,
    "28": 131,
    "29": 29,
    "30": 151,
    "31": 99,
    "32": 29,
    "33": 0,
    "34": 0,
    "35": 0,
    "36": 0,
  });

  const clientDataJSON = Object.values({
    "0": 123,
    "1": 34,
    "2": 116,
    "3": 121,
    "4": 112,
    "5": 101,
    "6": 34,
    "7": 58,
    "8": 34,
    "9": 119,
    "10": 101,
    "11": 98,
    "12": 97,
    "13": 117,
    "14": 116,
    "15": 104,
    "16": 110,
    "17": 46,
    "18": 103,
    "19": 101,
    "20": 116,
    "21": 34,
    "22": 44,
    "23": 34,
    "24": 99,
    "25": 104,
    "26": 97,
    "27": 108,
    "28": 108,
    "29": 101,
    "30": 110,
    "31": 103,
    "32": 101,
    "33": 34,
    "34": 58,
    "35": 34,
    "36": 54,
    "37": 72,
    "38": 98,
    "39": 95,
    "40": 49,
    "41": 106,
    "42": 73,
    "43": 48,
    "44": 77,
    "45": 104,
    "46": 49,
    "47": 82,
    "48": 69,
    "49": 78,
    "50": 106,
    "51": 86,
    "52": 107,
    "53": 68,
    "54": 70,
    "55": 98,
    "56": 117,
    "57": 54,
    "58": 83,
    "59": 45,
    "60": 65,
    "61": 66,
    "62": 99,
    "63": 76,
    "64": 77,
    "65": 72,
    "66": 113,
    "67": 103,
    "68": 121,
    "69": 82,
    "70": 108,
    "71": 97,
    "72": 65,
    "73": 85,
    "74": 103,
    "75": 54,
    "76": 101,
    "77": 49,
    "78": 56,
    "79": 34,
    "80": 44,
    "81": 34,
    "82": 111,
    "83": 114,
    "84": 105,
    "85": 103,
    "86": 105,
    "87": 110,
    "88": 34,
    "89": 58,
    "90": 34,
    "91": 104,
    "92": 116,
    "93": 116,
    "94": 112,
    "95": 115,
    "96": 58,
    "97": 47,
    "98": 47,
    "99": 108,
    "100": 111,
    "101": 99,
    "102": 97,
    "103": 108,
    "104": 104,
    "105": 111,
    "106": 115,
    "107": 116,
    "108": 58,
    "109": 51,
    "110": 48,
    "111": 48,
    "112": 48,
    "113": 34,
    "114": 44,
    "115": 34,
    "116": 99,
    "117": 114,
    "118": 111,
    "119": 115,
    "120": 115,
    "121": 79,
    "122": 114,
    "123": 105,
    "124": 103,
    "125": 105,
    "126": 110,
    "127": 34,
    "128": 58,
    "129": 102,
    "130": 97,
    "131": 108,
    "132": 115,
    "133": 101,
    "134": 125,
  });

  const signature = Object.values({
    "0": 48,
    "1": 70,
    "2": 2,
    "3": 33,
    "4": 0,
    "5": 148,
    "6": 135,
    "7": 177,
    "8": 40,
    "9": 108,
    "10": 95,
    "11": 145,
    "12": 123,
    "13": 153,
    "14": 220,
    "15": 54,
    "16": 222,
    "17": 67,
    "18": 81,
    "19": 247,
    "20": 4,
    "21": 194,
    "22": 63,
    "23": 123,
    "24": 133,
    "25": 55,
    "26": 182,
    "27": 137,
    "28": 112,
    "29": 138,
    "30": 218,
    "31": 26,
    "32": 35,
    "33": 137,
    "34": 126,
    "35": 67,
    "36": 145,
    "37": 2,
    "38": 33,
    "39": 0,
    "40": 217,
    "41": 221,
    "42": 17,
    "43": 186,
    "44": 95,
    "45": 85,
    "46": 219,
    "47": 242,
    "48": 213,
    "49": 25,
    "50": 242,
    "51": 2,
    "52": 75,
    "53": 208,
    "54": 213,
    "55": 122,
    "56": 229,
    "57": 12,
    "58": 159,
    "59": 85,
    "60": 139,
    "61": 147,
    "62": 255,
    "63": 124,
    "64": 255,
    "65": 243,
    "66": 124,
    "67": 242,
    "68": 232,
    "69": 240,
    "70": 196,
    "71": 75,
  });

  const wa_sig = await webauthn_signature(
    {
      authenticatorData,
      clientDataJSON,
      signature,
    },
    public_key
  );

  deepStrictEqual(
    wa_sig,
    "SIG_WA_K5aLPmtbb7AWnBQqBp7WJ825dGKL9Gwx2ZqX9F48TMBdJpEVXk32QWTLmUwwHM9ANnNgoMy1KApQoGVXTTbfp12xyWhCXTFtJdRsr6ScpGkgTuoAj4LSXDC6CGPeadZ32VZh6NZ3JvpAYJSVwRm2A3iUGHwEV9MvGWkRkZ14CYdYoqs1FiC1oLFzVrB6Jba1jypvXbzBH55GJz6ArWKuM14MwhEoLayNbLggqsQrEjyFCcVAmbaNBUVi8YDgRumxvUwM5MrtvTHfN5yBYUVTcM63BsYAqbrsGdTeKozdme9Zimt4RaggfamDCwLkmX3JG1kA4oG3RJAgF"
  );
  delete global.window;
});
it("WA signature 5", async () => {
  global.window = { crypto: { subtle: webcrypto.subtle } };

  const authenticatorData = Object.values({
    "0": 73,
    "1": 150,
    "2": 13,
    "3": 229,
    "4": 136,
    "5": 14,
    "6": 140,
    "7": 104,
    "8": 116,
    "9": 52,
    "10": 23,
    "11": 15,
    "12": 100,
    "13": 118,
    "14": 96,
    "15": 91,
    "16": 143,
    "17": 228,
    "18": 174,
    "19": 185,
    "20": 162,
    "21": 134,
    "22": 50,
    "23": 199,
    "24": 153,
    "25": 92,
    "26": 243,
    "27": 186,
    "28": 131,
    "29": 29,
    "30": 151,
    "31": 99,
    "32": 29,
    "33": 0,
    "34": 0,
    "35": 0,
    "36": 0,
  });

  const clientDataJSON = Object.values({
    "0": 123,
    "1": 34,
    "2": 116,
    "3": 121,
    "4": 112,
    "5": 101,
    "6": 34,
    "7": 58,
    "8": 34,
    "9": 119,
    "10": 101,
    "11": 98,
    "12": 97,
    "13": 117,
    "14": 116,
    "15": 104,
    "16": 110,
    "17": 46,
    "18": 103,
    "19": 101,
    "20": 116,
    "21": 34,
    "22": 44,
    "23": 34,
    "24": 99,
    "25": 104,
    "26": 97,
    "27": 108,
    "28": 108,
    "29": 101,
    "30": 110,
    "31": 103,
    "32": 101,
    "33": 34,
    "34": 58,
    "35": 34,
    "36": 69,
    "37": 69,
    "38": 74,
    "39": 87,
    "40": 88,
    "41": 118,
    "42": 121,
    "43": 110,
    "44": 98,
    "45": 119,
    "46": 68,
    "47": 120,
    "48": 51,
    "49": 105,
    "50": 74,
    "51": 73,
    "52": 84,
    "53": 112,
    "54": 82,
    "55": 106,
    "56": 109,
    "57": 105,
    "58": 98,
    "59": 50,
    "60": 120,
    "61": 89,
    "62": 72,
    "63": 117,
    "64": 65,
    "65": 119,
    "66": 70,
    "67": 98,
    "68": 88,
    "69": 95,
    "70": 74,
    "71": 67,
    "72": 106,
    "73": 97,
    "74": 72,
    "75": 114,
    "76": 112,
    "77": 55,
    "78": 65,
    "79": 34,
    "80": 44,
    "81": 34,
    "82": 111,
    "83": 114,
    "84": 105,
    "85": 103,
    "86": 105,
    "87": 110,
    "88": 34,
    "89": 58,
    "90": 34,
    "91": 104,
    "92": 116,
    "93": 116,
    "94": 112,
    "95": 115,
    "96": 58,
    "97": 47,
    "98": 47,
    "99": 108,
    "100": 111,
    "101": 99,
    "102": 97,
    "103": 108,
    "104": 104,
    "105": 111,
    "106": 115,
    "107": 116,
    "108": 58,
    "109": 51,
    "110": 48,
    "111": 48,
    "112": 48,
    "113": 34,
    "114": 44,
    "115": 34,
    "116": 99,
    "117": 114,
    "118": 111,
    "119": 115,
    "120": 115,
    "121": 79,
    "122": 114,
    "123": 105,
    "124": 103,
    "125": 105,
    "126": 110,
    "127": 34,
    "128": 58,
    "129": 102,
    "130": 97,
    "131": 108,
    "132": 115,
    "133": 101,
    "134": 125,
  });

  const signature = Object.values({
    "0": 48,
    "1": 69,
    "2": 2,
    "3": 32,
    "4": 69,
    "5": 137,
    "6": 236,
    "7": 208,
    "8": 93,
    "9": 149,
    "10": 10,
    "11": 175,
    "12": 112,
    "13": 172,
    "14": 166,
    "15": 17,
    "16": 116,
    "17": 79,
    "18": 53,
    "19": 197,
    "20": 128,
    "21": 47,
    "22": 246,
    "23": 198,
    "24": 70,
    "25": 225,
    "26": 63,
    "27": 203,
    "28": 191,
    "29": 19,
    "30": 140,
    "31": 45,
    "32": 245,
    "33": 7,
    "34": 235,
    "35": 130,
    "36": 2,
    "37": 33,
    "38": 0,
    "39": 136,
    "40": 136,
    "41": 136,
    "42": 252,
    "43": 25,
    "44": 186,
    "45": 161,
    "46": 24,
    "47": 88,
    "48": 24,
    "49": 175,
    "50": 61,
    "51": 32,
    "52": 155,
    "53": 243,
    "54": 3,
    "55": 142,
    "56": 230,
    "57": 159,
    "58": 30,
    "59": 140,
    "60": 108,
    "61": 70,
    "62": 219,
    "63": 11,
    "64": 13,
    "65": 21,
    "66": 250,
    "67": 145,
    "68": 162,
    "69": 91,
    "70": 29,
  });

  const wa_sig = await webauthn_signature(
    {
      authenticatorData,
      clientDataJSON,
      signature,
    },
    public_key
  );

  deepStrictEqual(
    wa_sig,
    "SIG_WA_JMTejvQoxh1JWw5d5x1F54v5jfguXPZJ4CqTry5b64cXUhSivXntpAmVyaMhkNi5a3CwKDLoAzrH7gjBWPGMzJ3zooN9ZjzmfNdjMiDKfj5xokkCJ1mxjPRUJ3q1eCqiK4Lb7a9XE9LQn8oYu6m69WjiHkNQmScTVHKRh7bFNShvV2tNBRj3g9pn8E6s53dxnUYo88Y8tDFHn7t6UvkZXR7CeYmmdYMcyxquFcjLjga3trkQo6zaCA23KAprixS87fV3BkuvrkvzQC4DqdrUv8dQAatyfPZNNkWWX25fxK8VmDMugfiG4nDWrNkceLHrgAbXqLuwccdmu"
  );
  delete global.window;
});
